<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="diaryMapper">
  	<resultMap type="diary" id="diaryResultSet">
  		<result column="DIARY_NO" property="diaryNo"/>
  		<result column="CATEGORY_NO" property="categoryNo"/>
  		<result column="BOARD_WRITER" property="boardWriter"/>
  		<result column="START_DATE" property="startDate"/>
  		<result column="END_DATE" property="endDate"/>
  		<result column="DIARY_TITLE" property="diaryTitle"/>
  		<result column="DIARY_CONTENT" property="diaryContent"/>
  		<result column="SELECT_OPEN" property="selectOpen"/>
  		<result column="CREATE_DATE" property="createDate"/>
  		<result column="STATUS" property="status"/>
  	</resultMap>
  	
  	<!-- 정보수정 -->
  	<update id="updateMember" parameterType="member">
  			UPDATE MEMBER
			SET USER_NAME = #{userName}
			   ,EMAIL = #{email}
			   ,PHONE = #{phone}
			   ,ADDRESS = #{address}
			   ,MODIFY_DATE = SYSDATE
			WHERE USER_ID = #{userId}
			AND STATUS = 'Y'
  		</update>
  	
  	<!-- 비밀번호 변경 -->
  	<update id="updatePwd" parameterType="member">
  		UPDATE MEMBER
  		SET USER_PWD = #{userPwd}
  		WHERE USER_ID = #{userId}
  		AND STATUS = 'Y'
  	</update>
  	<!-- 내가 쓴 게시글 개수 -->
  	<select id="boardListCount" parameterType="board" resultType="_int"> 
	SELECT COUNT(*)
	FROM BOARD B
   	JOIN MEMBER M ON(USER_NO=BOARD_WRITER)
	WHERE USER_ID = #{userId}
	AND B.STATUS = 'Y'
	</select>
	
	<!-- 내가 쓴 댓글 개수 -->
	<select id="replyListCount" parameterType="boardReply" resultType="_int"> 
	SELECT COUNT(*)
	FROM BOARD_REPLY R
	JOIN MEMBER M ON(USER_NO=REPLY_WRITER)
	WHERE USER_ID = #{userId}
	AND STATUS = 'Y'
	</select>
	
	<!-- 팔로잉수 -->
	<select id="fwingListCount" parameterType="follow" resultType="_int"> 
	SELECT COUNT(FOLLOWING_ID)
	FROM FOLLOW F
	JOIN MEMBER M ON(USER_ID=USER_NO)
	WHERE M.USER_ID = #{userId}
	</select>
	
	<!-- 팔로워수 -->
	<select id="fwerListCount" parameterType="follow" resultType="_int"> 
	SELECT COUNT(USER_ID)
	FROM FOLLOW F
	WHERE FOLLOWING_ID = #{userId}
	</select>
  
  	<!-- 일지등록 -->
  	<insert id="insertDiary">
  		INSERT INTO DIARY_BOARD VALUES(SEQ_DBNO.NEXTVAL
								  		,#{categoryNo}
								  		,1
								  		,#{startDate}
								  		,#{endDate}
								  		,#{diaryTitle}
								        ,#{diaryContent}
										,'N'
										,SYSDATE
										,'Y')
  	</insert>
  	
  	<!-- 회원 탈퇴 -->
  	<update id="deleteMember" parameterType="string">
  			UPDATE MEMBER
  			SET STATUS = 'N'
  			WHERE USER_ID = #{userId}
  			AND STATUS = 'Y'
  	</update>
  	
  	
  </mapper>